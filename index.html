<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–π –ë–ª–æ–≥</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo">–ú–æ–π –ë–ª–æ–≥</a>
                <nav>
                    <ul>
                        <li><a href="#" class="active">–ì–ª–∞–≤–Ω–∞—è</a></li>
                        <li><a href="–∫–æ–Ω—Ç–∞–∫—Ç—ã.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–æ–π –±–ª–æ–≥</h1>
            <p>–ó–¥–µ—Å—å —è –¥–µ–ª—é—Å—å –º—ã—Å–ª—è–º–∏, –æ–ø—ã—Ç–æ–º –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º–∏ –Ω–∞—Ö–æ–¥–∫–∞–º–∏</p>
        </div>
    </section>

    <main class="container">
        <div id="blog-container" class="blog-grid">
            <div class="loading">
                <p>–ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç—å–∏...</p>
            </div>
        </div>
    </main>

    <div id="article-modal" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <div id="modal-body"></div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <p>&copy; 2024 –ú–æ–π –ë–ª–æ–≥. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
                <p style="margin-top: 0.5rem; opacity: 0.8;">–ò–¥–∏—Ç–µ –Ω–∞...</p>
            </div>
        </div>
    </footer>

    <script>
        // =============================================================================
        // –°–ü–ò–°–û–ö –°–¢–ê–¢–ï–ô –ë–õ–û–ì–ê - –î–û–ë–ê–í–õ–Ø–ô–¢–ï –°–Æ–î–ê –°–í–û–ò MD –§–ê–ô–õ–´!
        // =============================================================================
        const BLOG_POSTS = [
            ' .md',
            '.md',
            '–ù–æ–≤—ã–π –≥–æ–¥ –∏ –µ–≥–æ –ø—Ä–æ–±–ª–µ–º—ã.md'
            // –î–æ–±–∞–≤–ª—è–π—Ç–µ —Å—é–¥–∞ –Ω–æ–≤—ã–µ —Å—Ç–∞—Ç—å–∏:
            // '–º–æ—è-–Ω–æ–≤–∞—è-—Å—Ç–∞—Ç—å—è.md',
            // '–µ—â–µ-–æ–¥–Ω–∞-—Å—Ç–∞—Ç—å—è.md'
        ];
        // =============================================================================

        class BlogManager {
            constructor() {
                this.blogContainer = document.getElementById('blog-container');
                this.modal = document.getElementById('article-modal');
                this.modalBody = document.getElementById('modal-body');
                this.posts = [];
            }

            async init() {
                await this.loadAllPosts();
                this.renderBlog();
            }

            async loadAllPosts() {
                this.posts = [];
                let loadedCount = 0;

                for (const filename of BLOG_POSTS) {
                    const success = await this.loadPost(filename);
                    if (success) loadedCount++;
                }

                if (loadedCount === 0) {
                    this.showError();
                }
            }

            async loadPost(filename) {
                try {
                    const response = await fetch(filename);
                    if (!response.ok) {
                        throw new Error(`–§–∞–π–ª ${filename} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                    }
                    
                    const content = await response.text();
                    const lines = content.split('\n');
                    
                    let title = this.filenameToTitle(filename);
                    let excerpt = '';
                    let date = new Date().toLocaleDateString('ru-RU');
                    let category = '–°—Ç–∞—Ç—å—è';
                    let image = 'üìù';

                    if (lines[0].startsWith('---')) {
                        let i = 1;
                        while (i < lines.length && !lines[i].startsWith('---')) {
                            const line = lines[i];
                            if (line.startsWith('title:')) {
                                title = line.replace('title:', '').trim();
                            } else if (line.startsWith('excerpt:')) {
                                excerpt = line.replace('excerpt:', '').trim();
                            } else if (line.startsWith('date:')) {
                                date = line.replace('date:', '').trim();
                            } else if (line.startsWith('category:')) {
                                category = line.replace('category:', '').trim();
                            } else if (line.startsWith('image:')) {
                                image = line.replace('image:', '').trim();
                            }
                            i++;
                        }
                    }

                    if (!excerpt) {
                        const contentStart = lines.findIndex(line => !line.startsWith('---') && line.trim() !== '');
                        if (contentStart !== -1) {
                            excerpt = lines.slice(contentStart, contentStart + 3)
                                .join(' ')
                                .substring(0, 120) + '...';
                        } else {
                            excerpt = '–ß–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç—å—é...';
                        }
                    }

                    this.posts.push({
                        filename,
                        title,
                        excerpt,
                        date,
                        category,
                        image,
                        content
                    });

                    return true;
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${filename}:`, error);
                    return false;
                }
            }

            filenameToTitle(filename) {
                return filename
                    .replace('.md', '')
                    .replace(/[-_]/g, ' ')
                    .replace(/\b\w/g, l => l.toUpperCase());
            }

            renderBlog() {
                if (this.posts.length === 0) {
                    this.showError();
                    return;
                }

                this.blogContainer.innerHTML = this.posts.map(post => `
                    <article class="blog-card" onclick="blogManager.openArticle('${post.filename}')">
                        <div class="blog-image">
                            ${post.image}
                        </div>
                        <div class="blog-content">
                            <div class="blog-meta">
                                <span class="blog-date">${post.date}</span>
                                <span class="blog-category">${post.category}</span>
                            </div>
                            <h3 class="blog-title">${post.title}</h3>
                            <p class="blog-excerpt">${post.excerpt}</p>
                            <a href="#" class="read-more" onclick="event.stopPropagation(); blogManager.openArticle('${post.filename}')">
                                –ß–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç—å—é <i class="fas fa-arrow-right"></i>
                            </a>
                        </div>
                    </article>
                `).join('');
            }

            showError() {
                this.blogContainer.innerHTML = `
                    <div class="error" style="grid-column: 1 / -1;">
                        <h3>–°—Ç–∞—Ç—å–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                        <p>–°–æ–∑–¥–∞–π—Ç–µ MD —Ñ–∞–π–ª—ã –∏ –¥–æ–±–∞–≤—å—Ç–µ –∏—Ö –Ω–∞–∑–≤–∞–Ω–∏—è –≤ –∫–æ–¥:</p>
                        <div style="background: #f5f5f5; padding: 1rem; border-radius: 8px; margin: 1rem 0; text-align: left;">
                            <code style="color: var(--primary);">
                                const BLOG_POSTS = [<br>
                                &nbsp;&nbsp;'–ø–µ—Ä–≤–∞—è-—Å—Ç–∞—Ç—å—è.md',<br>
                                &nbsp;&nbsp;'–≤—Ç–æ—Ä–∞—è-—Å—Ç–∞—Ç—å—è.md',<br>
                                &nbsp;&nbsp;'–≤–∞—à–∞-—Å—Ç–∞—Ç—å—è.md'<br>
                                ];
                            </code>
                        </div>
                    </div>
                `;
            }

            openArticle(filename) {
                const post = this.posts.find(p => p.filename === filename);
                if (!post) return;

                const htmlContent = marked.parse(post.content);
                this.modalBody.innerHTML = `
                    <div style="margin-bottom: 2rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; font-size: 0.9rem; color: var(--gray);">
                            <span>${post.date}</span>
                            <span style="background: var(--primary); color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">${post.category}</span>
                        </div>
                        <h1 style="color: var(--dark); margin-bottom: 1rem; font-size: 2rem; line-height: 1.3;">${post.title}</h1>
                    </div>
                    <div class="md-content">
                        ${htmlContent}
                    </div>
                `;
                
                this.modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }

            closeModal() {
                this.modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }

        const blogManager = new BlogManager();

        document.querySelector('.close-modal').addEventListener('click', () => {
            blogManager.closeModal();
        });

        document.getElementById('article-modal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) {
                blogManager.closeModal();
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            blogManager.init();
        });
    </script>
</body>
</html>